# 二叉搜索树、AVL树、红黑树、B树

## BST

BST 的中序遍历结果是按升序排列的

## AVL树

AVL树和红黑树适合用于内部存储，B树适合用于外部存储

C++的STL类map和multimap使用的是红黑树结构，以保证查找、插入和删除操作具有对数级别的时间性能

AVL树对每个插入操作最多需要一次旋转，对每个删除操作最多需要O(logn)次旋转

红黑树对每个插入和删除都只需要一次旋转

### 插入

- 单独右旋、单独左旋操作：大话P335 P336
- 最小不平衡子树（设跟为T）左旋平衡处理：LL或LR，设T->left=L
  - LL：插入的元素在T->left->left，那么L的bf为1，对T做单独左旋处理
  - LR：插入的元素在T->left->right，那么L的bf为-1，对T做双旋处理
    - 根据L右孩子的bf修改T和L的bf值
    - 左旋T->left
    - 右旋T

完整代码：大话P338

## 红黑树

性质

- 树中每一个节点的颜色或者是黑色或者是红色
- 根节点和所有外部节点都是黑色
- 在根至外部节点路径上，没有连续两个节点是红色
- 在所有跟至外部节点的路径上，黑色节点数目都相同（包括外部节点）

红黑树节点的阶：

- 从该节点到一外部节点路径上黑色节点的数量（不算该节点）

### 插入

应将新节点赋为红色

如果将新节点u赋为红色导致出现了连续的2个红色节点，意味着树的平衡被破坏，不平衡类型（u的父节点pu必为红，祖父节点gu必为黑）：

- LLb不平衡：pu是gu左孩子，u是pu左孩子，gu另一个孩子是黑色
- LLr不平衡：pu是gu左孩子，u是pu左孩子，gu另一个孩子是黑色
- LRb
- LRr
- RRb
- RRr
- RLb
- RLr

处理r型不平衡需要改变颜色；处理b型不平衡需要旋转。无论哪种不平衡处理完后，要检查gu的改变是否影响了上层的RB2特性。如果不平衡，gu变为u，再次进行转换

- LLr和LRr：将pu、gu的右孩子由红色改为黑色；如果gu不是跟，将gu改为红色；所有的路径上黑色节点数量+1
- LLb和LRb：类似AVL的旋转操作；所有的路径上黑色节点数量不变；相关子树的跟在旋转后是黑色的，因此不需要再做平衡
